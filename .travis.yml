language: php
php:
- '7.2'
sudo: required
dist: bionic
addons:
  ssh_known_hosts: 206.189.122.208
before_script:
- cp .env.travis .env
- mysql -e 'create database homestead;'
- composer install --no-interaction
- php artisan key:generate
- php artisan passport:keys
- php artisan migrate --seed --force
- php artisan serve &
before_deploy:
# Decrypt our staging private SSH key. This command is automatically generated by Travis when you encrypt a file.
- openssl aes-256-cbc -K $encrypted_f8d9f1054808_key -iv $encrypted_f8d9f1054808_iv
  -in staging_rsa.enc -out staging_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 staging_rsa
- ssh-add staging_rsa
deploy:
  # Deploy to staging.
  - provider: script
    skip_cleanup: true
    script: rsync -r --exclude storage --delete-after --quiet $TRAVIS_BUILD_DIR/* $STAGING_USER@$STAGING_IP:/home/$STAGING_USER/staging/service
    on:
      branch: 1.7/release
  # Create production release tarball.
  - provider: script
    skip_cleanup: true
    script: tar -czf $TRAVIS_TAG.tar.gz ARCVService && scp $TRAVIS_TAG.tar.gz $STAGING_USER@$STAGING_IP:/home/$STAGING_USER/releases/service
    on:
      tags: true
services:
- mysql
cache:
  # Cache composer's cache, for fast installs
  directories:
  - $HOME/.composer/cache/files  
env:
  global:
  # STAGING_USER
  - secure: b+QCBd/bBxucU+Ne1vQm8/0IixyOyP/fj5Xsh06LQXiFMXPvg8mqjKW0J98zJj+WlwKjZhsovbjN8j4JSaxPtkyrNiP0tuJhRvjzVauZHWFrgrvsP/oTaGjrkRdSYQqQwle+AtZwysY23VpU3wU9pKQ36bkA8AVYslggbTXfQ+aaPmAPamvJ3c0xLpnLJiM4yHuVyKKa3K793K6idiEoTZRDVB5065jOWs4YHzEDGMljJB3JTCOh4PW2iHtCsQ5XAmVXs6mlHb1Nc6inF9BSdmzaKBgoQRezD5cYAy9pmYc5XiCOF++FC4utTLhajv3pFHWS6vKRMcatch5aXFWmsmgkz/Kt/0ZMH2w2+qbGX2CFkqvDrdmbPHrykO2J1Tu+yQ9UzQpEOKi1IFGuoJ33Ku09Fjavz6hCsx85Sf1NVeFgZ0wWkK6ZCJwXHnw+YJZH77qN8Kc9thk+1f2opsizAEcMRZmKQ3oMU6xJ4BdF2rkh4WB+p9RhyyhJwcHQ6Px31vcohIrzBwTt0abmMTogMWAeLXnKwFeZ8vwX4Y+Z2R3chI0CjSJD9mDTuA1GTqjigbhOZxwAfV62fBdjG3uuuFTYLoQIyftUk821Qfpvzg/qyTKOZanvdrPE4x6nntwHZBqOgTDMoAd26sRUtCfqPIWZvY0lSynqmy+n3l93ntM=
  # STAGING_IP
  - secure: i2qL+r1rCPqiWaBLxTfsvEP9jEfW4iDljahwYpt3pw8F/E2bFoWXYtTIxW9EXUBP6fM44uSwGVkiz0pHCi88h9KHoUVYx0sxYhuJk7n4o+SVk7YglL4+PHqLy4t+Ouq5c1l94IA9nfiO91L4SztM0gW+qrFOJQ+nyqUjdKkFcyyNLjTPkIUrAoyAsN4lPxG3bHz13ppU+4qO9WFzszG/ATJNcCPss+6nRAgFAk788V+l6J0apl12ydHx9qrhm18UipYGVi5MmdYoZgHKtM4V/sAqcAf17SWEOa2U9SAepkeCHPMFNJiLtTtzshaD1DPrjtABXSRVjZ0TKDxQLOneRp0WBNnpJo/BR2U+A3zPXYI5rUDqYEShqyrpdsrP5L0Uq0whkX+E/rYwHvuGR9EFM8sKf8sNNJ87yAeO5R9tcD6FjCq/5PHncWed/4h6brs7QQgu1QYlAh23/S39q9o6ZfphWpP0hmkBFKdo5HX1hfwdoHKO5f8Tw7VYQxq/YXc9PquMdQv9alx7yOV6c+f/s5mnDA/p1SSQqMOImqyTWeSQSAswiGSgoKhhbgMG5KtGc/e4wGzmO9U+VxaB3PPwDixZeZOuGjw9dfT4UAUI/NZX5FQnLdP4ZvkJCDV1kJchyOeHQHxGpG/QGsdKks7ecwYIbP21PTi211wEAfTDTbo=
